<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="foundation.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="d3-context-menu.css" />
    <!-- <style>
        #topNavigationBar {
            width: 49%;
        }
        
        #topNavigationBar ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            background-color: #333;
        }
        
        #topNavigationBar li {
            display: inline;
        }
        
        #content {
            width: 49%;
            float: left;
        }
        
        #topNavigationBar li a {
            display: inline;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }
    </style>-->
</head>

<body>
    <FORM NAME="kt">
        <INPUT TYPE="hidden" NAME="fld">
    </FORM>
    <!--<FORM NAME="url">
        <INPUT TYPE="button" NAME="restService" id="restServiceUrl">
    </FORM>-->
    <!--    <div id="topNavigationBar">
        <div class="topNavigationBar-menu">
            <ul>
                <li><a href="#">Subjects</a></li>
                <li><a href="#">Works</a></li>
                <li><a href="#">Users</a></li>
                <li><a href="#">Persons</a></li>
                <li><a href="#">Languages</a></li>
                <li><a href="#">Logout</a></li>
            </ul>
        </div>
    </div>-->

    <div id="ViewNodeModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <h2 id="modalTitle">View Node</h2>
        <form id="ViewNodeForm">
            <div class="row">
                <div class="large-12 columns">
                    <label>Node id
                  <input type="text" class="inputName" id='ViewNodeId' placeholder="node id" disabled="true" />
                    <label>Node name
                  <input type="text" class="inputName" id='ViewNodeName' placeholder="node name"  disabled="true"/>
                     <label>Node order
                  <input type="text" class="inputName" id='ViewNodeOrder' placeholder="node order" />
                     <label>Node description
                  <!--<input type="text" class="inputName" id='ViewNodeDescription' placeholder="node description" />-->
                        <textarea id="ViewNodeDescription" class="inputName" placeholder="node description" rows="10" disabled="true"></textarea>
                <label>Node relation
                  <input type="text" class="inputName" id='ViewNodeRelation' placeholder="node relation"  disabled="true"/>
              </label>
                </div>
            </div>
        </form>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>

    <div id="RenameNodeModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <h2 id="modalTitle">Edit Node</h2>
        <form id="RenameNodeForm">
            <div class="row">
                <div class="large-12 columns">
                    <label>Node id
                  <input type="text" class="inputName" id='RenameNodeId' placeholder="node id" disabled="true" />
                             <label>Node name
                  <input type="text" class="inputName" id='RenameNodeName' placeholder="node name" />
                    <label>Node order
                  <input type="text" class="inputName" id='RenameNodeOrder' placeholder="node order" />
                      <label>Node description
                  <!--<input type="text" class="inputName" id='RenameNodeDescription' placeholder="node description" />-->
                        <textarea id="RenameNodeDescription" class="inputName" placeholder="node description" rows="10"></textarea>
                <label>Node relation
                  <input type="text" list="renameRelationList" class="inputName" id='RenameNodeRelation' placeholder="node relation" />
              </label>
                    <datalist id="renameRelationList">
                </datalist>
                </div>
            </div>
            <div class="row">
                <div class="large-8 columns">
                    &nbsp;
                </div>
                <div class="large-4 columns">
                    <!--<a href="#" class="button info" onclick="close_rename_node_modal()">Cancel</a>-->
                    <a href="#" class="button success" onclick="rename_node()">Update</a>
                </div>
            </div>
        </form>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>

    <div id="CreateNodeModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <h2 id="modalTitle">Create Node</h2>
        <form id="CreateNodeForm">
            <div class="row">
                <div class="large-12 columns">
                    <label>Node name
                  <input type="text" class="inputName" id='CreateNodeName' placeholder="node name" onchange="generateId()"/>
                    <label>Node id
                  <input type="text" class="inputName" id='CreateNodeId' placeholder="node id" />
                    <label>Node order
                  <input type="text" class="inputName" id='CreateNodeOrder' placeholder="node order" />
                      <label>Node description
                  <textarea id="CreateNodeDescription" class="inputName" placeholder="node description" rows="10"></textarea>
                      <label>Node relation
                  <input type="text" list="createRelationList" class="inputName" id='CreateNodeRelation' placeholder="node relation" />
              </label>
                    <datalist id="createRelationList">
                </datalist>
                </div>
            </div>
            <div class="row">
                <div class="large-8 columns">
                    &nbsp;
                </div>
                <div class="large-4 columns">
                    <!--<a href="#" class="button info" onclick="close_create_node_modal()">Cancel</a>-->
                    <a href="#" class="button success" onclick="create_node()">Create</a>
                </div>
            </div>
        </form>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>

    <div id="MoveNodeModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
        <h2 id="modalTitle">Move Node</h2>
        <form id="MoveNodeForm">
            <div class="row">
                <div class="large-12 columns">
                    <label>Node id
                  <input type="text" class="inputName" id='MoveNodeId' placeholder="node id" />
                    <label>Node Order
                  <input type="text" class="inputName" id='MoveNodeOrder' placeholder="node order" />
                    <label> New Parent Node
                  <input type="text" list="MoveParentList" class="inputName" id='MoveParentNode' placeholder="parent node list" />
              </label>
                    <datalist id="MoveParentList">
                </datalist>
                </div>
            </div>
            <div class="row">
                <div class="large-8 columns">
                    &nbsp;
                </div>
                <div class="large-4 columns">
                    <!--<a href="#" class="button info" onclick="close_move_node_modal()">Cancel</a>-->
                    <a href="#" class="button success" onclick="move_node()">Move</a>
                </div>
            </div>
        </form>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>
    <div id="tree-container"></div>

    <!--<script src="https://d3js.org/d3.v3.min.js"></script>-->
    <script src="../d3.v3.min.js"></script>
    <script src="dndtree_work.js"></script>
    <script src="d3-context-menu.js"></script>
    <script src="underscore-min.js"></script>
    <script src="jquery.js"></script>
    <script src="fastclick.js"></script>
    <script src="foundation.min.js"></script>
    <script>
        function generateId() {
            id = $('#CreateNodeId').val();
            if (id.length > 0) return;
            name = $('#CreateNodeName').val();
            id = name.replace(/[ \-]/g, "");
            idl = id.length;
            if (idl > 20) {
                idtrunc = id.slice(0, 15) + id.slice(idl - 5, idl - 1);
                $('#CreateNodeId').val(idtrunc);
            } else $('#CreateNodeId').val(id);
        }
    </script>
    <script>
        // for the first initialization
        $('document').ready(function() {
            //  $("#restServiceUrl").load("restServiceUrl.txt");
            $(document).foundation();
            $(document).on('opened', '[data-reveal]', function() {
                var element = $(".inputName:visible").first();
                element.focus(function() {
                    this.selectionStart = this.selectionEnd = this.value.length;
                });
                element.focus();
            });
            $('#RenameNodeForm').submit(function(e) {
                rename_node();
                return false;
            });
            $('#CreateNodeForm').submit(function(e) {
                create_node();
                return false;
            });
            // var treeJSON = d3.json("tree.json", draw_tree);
            // var url = "http://127.0.0.1:5000/knowledgeTree/api/v1.0/";
            var url = "http://" + getIp() + ":5000/knowledgeTree/api/v1.0/";
            var auth = getauth();
            d3.json(url + "tree-work").header("Authorization", "Basic " + btoa(auth)).get(function(err, content) {
                if (err) console.log("error:", err);
                else {
                    draw_tree(err, content);
                    d3.json(url + "work-work-relations").header("Authorization", "Basic " + btoa(auth)).get(function(err, content) {
                        if (err) console.log("error:", err);
                        else {
                            $(content.relations).each(function() {
                                $('#createRelationList').append("<option value=\"" + this.id + "\"></option>");
                                $('#renameRelationList').append("<option value=\"" + this.id + "\"></option>");
                            });
                        }
                    });
                }
            });
        });
    </script>
</body>

</html>